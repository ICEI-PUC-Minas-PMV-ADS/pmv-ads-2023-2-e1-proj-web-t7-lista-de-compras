<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./stylesListas.css">
    <title>Listas</title>
</head>

<body>
    <div class="head">
        <button class="bt" id="balance" onclick="balance()">Consultar Saldo</button>
        <img id="logo" src="./logo.png" />
        <button class="bt" id="finalizarCompraBt" onclick="finalizarCompraBt()">Finalizar Compra</button>
    </div>
    <div class="div-principal">
        <button style="width: 20rem;height:3.5rem;font-size:18px;" class="bt" id="add-bt"
            onclick="newProduct()">Adicionar Produto</button>

        <div id="formulario">
            <span onclick="closeForm()">X</span>
            <form>
                <label>Nome:</label>
                <input id="name" type="text" placeholder="Suco de Caixinha" required>
                <label>Preço Unitário:</label>
                <input id="price" step="0.01" pattern="\d+(\.\d{1,2})?" type="number" placeholder="R$ 3,00" min="0"
                    required>
                <label>Quantidade:</label>
                <input id="qntd" step="1" pattern="\d+(\.\d{1,2})?" type="number" placeholder="Adicione a quantidade"
                    min="0" required>
                <select id="select" class="cat">
                    <option value="" disabled selected>Categoria</option>
                    <option value="Verdura">Verdura</option>
                    <option value="Higiene">Higiene</option>
                    <option value="Carne">Carne</option>
                    <option value="Fruta">Fruta</option>
                    <option value="Bebida">Bebidas</option>
                    <option value="Doces">Doces e Guloseimas</option>
                    <option value="Produto de Limpeza">Produtos de Limpeza</option>
                </select>
                <button type="submit" class="bt" style="width: 80%;" onclick="validationForm()">Salvar</button>
            </form>
        </div>
        <div class="div-itens">
            <input class="filtro-nome" type="text" id="filtroN" />
            <select class="categorias" id="filtroC">
                <option value="" disabled selected>Categorias</option>"
                <option value="Verdura">Verdura</option>
                <option value="Higiene">Higiene</option>
                <option value="Carne">Carne</option>
                <option value="Fruta">Fruta</option>
                <option value="Bebida">Bebidas</option>
                <option value="Doces">Doces e Guloseimas</option>
                <option value="Produto de Limpeza">Produtos de Limpeza</option>
            </select>
            <button class="bt-lupa" onclick="filterProd()"><img id="lupa" src="./lupa.png" /></button>
        </div>
        <div class="div-list">
            <script>
                const params = new URLSearchParams(window.location.search);
                id = params.get('id');
                

                const filtroC = document.getElementById('filtroC') //chama o elemento com ID definido
                const filtroN = document.getElementById('filtroN')//chama o elemento com ID definido

                let productList = JSON.parse(localStorage.getItem(`produtos${id}`))// pega os itens salvos no localStorage e salva na variavel productList

                function renderProducts(products) {

                    let containerList = document.getElementsByClassName("div-list")[0] //chama a div que tem a class definida
                    containerList.innerHTML = ''; // limpa tudo que esta na div para poder atualizar quando filtrar

                    productList.forEach(function (product) { // metodo forEach percorre o array de productList que foi salvo mais acima
                        let productDiv = document.createElement('div') // cria um elemento na DOM(uma div)

                        let produtoName = document.createElement('p'); // cria um elemento na DOM(um parágrafo)
                        produtoName.innerHTML = product.name // o innerHTML faz uma troca ou acrescenta um valor a alguma tag,aqui ele passa o valor de product.name para dentro do 'p' criado
                        produtoName.classList.add('nameP') // adiciona uma class ao 'p' criado

                        let produtoPrice = document.createElement('p');
                        produtoPrice.innerHTML = `R$ ${product.price}`

                        let quantity = document.createElement('p')
                        quantity.innerHTML = `Qtd: ${product.qntd}`

                        let deleteProduct = document.createElement('button') // cria um elemento na DOM(um botão)
                        deleteProduct.classList.add('bt-delete')

                        let trashImg = document.createElement('img') // cria um elemento na DOM(uma imagem)
                        trashImg.classList.add('imgTrash')

                        trashImg.src = '../Home/trash.png' // adiciona a propriedade de src a imagem
                        productDiv.classList.add('list')


                        productDiv.appendChild(produtoName)  // o appendChild adiciona um filho ao elemento pai,no caso o elemento pai é a productDiv que foi criada acima
                        productDiv.appendChild(produtoPrice)
                        productDiv.appendChild(quantity)
                        productDiv.appendChild(deleteProduct)

                        deleteProduct.appendChild(trashImg)

                        containerList.appendChild(productDiv)
                    })
                }
                function filterProd() { //funcão para filtrar os produtos por categoria
                    let produtos = JSON.parse(localStorage.getItem(`produtos${id}`)) || []; //busca os produtos no localStorage
                    let filteredProd = produtos.filter((prod) => prod.category === filtroC.value) // percorre o array de produtos e retorna o array com todos os itens que tem a categoria igual a categoria escolhida no select
                    productList = filteredProd //salva esse array filtrado na variavel productList
                    renderProducts(productList) //chama a função de renderização e passa como parametro o array de produtos que acabou de ser modificado
                }

                filtroN.addEventListener('input', function () {
                    let prodFilterName = JSON.parse(localStorage.getItem(`produtos${id}`)) || [];
                    let filterProd = prodFilterName.filter((prod) => prod.name.includes(filtroN.value));
                    productList = filterProd
                    renderProducts(productList)
                })

                renderProducts(productList) // ao iniciar a pagina executa a função passando o productList original com todos os itens sem filtros
            </script>
        </div>
    </div>
    <script src="./scripts.js"></script>
</body>

</html>